name: CI/CD Pipeline

on:
  push:
    branches:
      - dev  # This will trigger the action on push to dev branch

jobs:
  lint-html:
    name: Lint HTML Files
    runs-on: ubuntu-latest  # GitHub hosted runner (Ubuntu in this case)
    steps:
      - name: Checkout code
        uses: actions/checkout@v2  # Checkout the repository

      - name: Set up Node.js
        uses: actions/setup-node@v2  # Set up Node.js for linting dependencies
        with:
          node-version: '14'  # Specify the Node.js version (14 in this case)

      - name: Install HTML linting tool
        run: |
          npm install -g htmlhint  # Install the HTML linting tool globally

      - name: Lint HTML files
        run: |
          htmlhint ./**/*.html  # Lint all HTML files recursively

  sync-to-main:
    name: Sync Dev to Main
    runs-on: ubuntu-latest  # This job also runs on a GitHub runner
    needs: lint-html  # This job runs only if lint-html is successful
    if: success()  # Proceed only if the previous linting step was successful
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up Git user
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"

      - name: Sync dev branch to main
        run: |
          git checkout main  # Switch to the main branch
          git merge dev --no-ff -m "Sync dev to main after successful linting"  # Merge dev into main
          git push origin main  # Push the changes to the main branch
